<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Info -->
    <title>hammock suspension calculator</title>
    <meta name="author" content="Elliott Claus" />
    <meta name="description" content="Elliott's Webiste" />
    <meta name="keywords" content="Resume, Projects, Github, Programming" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="UTF-8" />
    <!-- References -->
    <script
      src="../components/notesHeader.js"
      type="text/javascript"
      defer
    ></script>
    <script src="../components/footer.js" type="text/javascript" defer></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../styles.css" />
    <!-- Favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../images/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../images/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../images/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="../images/favicon/site.webmanifest" />
    <style>
      .test-container {
        max-width: 500px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        text-align: center;
        color: #333;
      }
      label {
        display: block;
        margin-bottom: 5px;
      }
      input {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      #results {
        margin-top: 20px;
        padding: 10px;
        background-color: #e7f3ff;
        border-radius: 4px;
      }
      .on-track {
        color: green;
      }
      .behind-schedule {
        color: red;
      }
      .number {
        background-color: yellow;
        font-weight: bold;
      }
      p {
        text-indent: 0;
      }
      .numbers {
        border-radius: 5px;
        border: 1px solid #000;
        padding: 10px;
      }
    </style>
  </head>

  <body class="d-flex flex-column h-100 vsc-initialized">
    <!-- Begin page content -->
    <main class="flex-shrink-0">
      <!-- Navbar -->
      <notes-header></notes-header>
      <!-- Main -->
      <div class="container">
        <h1 class="mt-5">hammock suspension calculator</h1>
        <p class="lead">
          calculate all the lengths you can get with different hammock
          suspension lengths combined
        </p>
        <div class="row">
          <div class="col-12">
            <button
              class="btn btn-light btn-sm"
              id="custom_input"
              onclick="customInput()"
            >
              input my suspension numbers
            </button>
            <br /><br />
            <form id="suspensionDefinitionForm" class="test-container">
              <label for="minBuryLength">minimum bury length:</label>
              <input type="number" id="minBuryLength" required />

              <label for="minFoldLength">minimum fold length:</label>
              <input type="number" id="minFoldLength" required />
              <br /><br />

              <div class="numbers">
                <div class="numbers">
                  <label for="length1">suspension length 1:</label>
                  <input type="number" id="length1" required />
                  <label for="length1type">length 1 type:</label>
                  <select id="length1type">
                    <option value="loop" default>continuous loop</option>
                    <option value="dogbone">dogbone</option>
                  </select>
                </div>
                <div class="numbers">
                  <label for="length2">suspension length 2:</label>
                  <input type="number" id="length2" required />
                  <label for="length2type">length 2 type:</label>
                  <select id="length2type">
                    <option value="loop">continuous loop</option>
                    <option value="dogbone" default>dogbone</option>
                  </select>
                </div>
                <div class="numbers">
                  <label for="length3">suspension length 3:</label>
                  <input type="number" id="length3" required />

                  <label for="length3type">length 3 type:</label>
                  <select id="length3type">
                    <option value="loop">continuous loop</option>
                    <option value="dogbone" default>dogbone</option>
                  </select>
                </div>
                <div class="numbers">
                  <label for="length4">suspension length 4:</label>
                  <input type="number" id="length4" required />

                  <label for="length4type">length 4 type:</label>
                  <select id="length4type">
                    <option value="loop">continuous loop</option>
                    <option value="dogbone" default>dogbone</option>
                  </select>
                </div>
              </div>
              <br /><br />
              <input type="submit" value="Calculate" />
            </form>
          </div>
        </div>
        <div class="row">
          <div id="results" class="test-container"></div>
        </div>
        <div class="row">
          <div class="col-12">
            <p>.</p>
            <p>.</p>
          </div>
        </div>
      </div>
    </main>
    <!-- Footer -->
    <footer-component></footer-component>
    <!-- Necessary for dropdowns -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>
    <script>
      function customInput() {
        document.getElementById('minFoldLength').value = 20;
        document.getElementById('minBuryLength').value = 5;
        document.getElementById('length1').value = 6;
        document.getElementById('length2').value = 12;
        document.getElementById('length3').value = 40;
        document.getElementById('length4').value = 110;
        document.getElementById('length1type').value = 'loop';
        document.getElementById('length2type').value = 'loop';
        document.getElementById('length3type').value = 'dogbone';
        document.getElementById('length4type').value = 'dogbone';
      }

      document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('suspensionDefinitionForm');
        const results = document.getElementById('results');

        form.addEventListener('submit', function (e) {
          e.preventDefault();
          calculateSuspensionOptions();
          document.querySelectorAll('p').forEach((p) => {
            const content = p.textContent;
            const highlighted = content.replace(
              /\d+(?:\.\d+)?/g,
              (match) => `<span class="number">${match}</span>`
            );
            p.innerHTML = highlighted;
          });
        });

        function calculateSuspensionOptions() {
          // Get input values
          const minFoldLength = parseFloat(
            document.getElementById('minFoldLength').value
          );
          const lengths = [
            parseFloat(document.getElementById('length1').value),
            parseFloat(document.getElementById('length2').value),
            parseFloat(document.getElementById('length3').value),
            parseFloat(document.getElementById('length4').value),
          ].filter((length) => !isNaN(length) && length > 0);

          // Get loop types
          const types = [
            document.getElementById('length1type').value,
            document.getElementById('length2type').value,
            document.getElementById('length3type').value,
            document.getElementById('length4type').value,
          ].slice(0, lengths.length);

          // Calculate rope needed for each loop
          function calculateRopeNeeded(length, type) {
            const buryLength = parseFloat(
              document.getElementById('minBuryLength').value
            );
            if (type === 'dogbone') {
              return length + buryLength * 2;
            } else {
              // continuous loop
              return length * 2 + buryLength * 2;
            }
          }

          // Calculate rope requirements
          const ropeRequirements = lengths.map((length, index) => ({
            loopNumber: index + 1,
            loopLength: length,
            type: types[index],
            ropeNeeded: calculateRopeNeeded(length, types[index]),
          }));

          const totalRopeNeeded = ropeRequirements.reduce(
            (sum, req) => sum + req.ropeNeeded,
            0
          );

          // Object to store possible lengths and their combinations
          const lengthCombinations = new Map(); // key: final length, value: array of combinations

          // Calculate all possible folded lengths for a single loop
          function getFoldedLengths(originalLength) {
            const lengths = [];
            let currentLength = originalLength;
            let folds = 0;

            // Add the full length
            lengths.push({ length: currentLength, folds: folds });

            // Keep folding in half until we reach minimum fold length
            while (currentLength >= minFoldLength * 2) {
              currentLength = currentLength / 2;
              folds++;
              lengths.push({ length: currentLength, folds: folds });
            }

            return lengths;
          }

          // Generate all possible combinations of indices
          function* generateCombinations(arr, size) {
            if (size === 1) {
              for (let i = 0; i < arr.length; i++) {
                yield [arr[i]];
              }
              return;
            }

            for (let i = 0; i < arr.length; i++) {
              const first = arr[i];
              const remaining = arr.slice(i + 1);
              for (const combo of generateCombinations(remaining, size - 1)) {
                yield [first, ...combo];
              }
            }
          }

          // Calculate all possible combinations
          function calculateCombinations(lengths) {
            const loopData = lengths.map((length, index) => ({
              originalLength: length,
              loopIndex: index + 1,
              foldedOptions: getFoldedLengths(length),
            }));

            const indices = [...Array(loopData.length).keys()];

            // For each possible number of loops to combine (1 to total loops)
            for (let numLoops = 1; numLoops <= loopData.length; numLoops++) {
              // Generate all possible combinations of that many loops
              for (const indexCombo of generateCombinations(
                indices,
                numLoops
              )) {
                // Get all possible folding combinations for these loops
                const foldingCombos = indexCombo.map(
                  (index) => loopData[index].foldedOptions
                );

                // Generate cartesian product of folding options
                const cartesian = (...arrays) =>
                  arrays.reduce(
                    (acc, array) =>
                      acc.flatMap((x) => array.map((y) => [...x, y])),
                    [[]]
                  );

                const allFoldingCombos = cartesian(...foldingCombos);

                // Calculate sum for each folding combination
                allFoldingCombos.forEach((foldingCombo) => {
                  const sum = foldingCombo.reduce(
                    (acc, fold) => acc + fold.length,
                    0
                  );
                  const combination = foldingCombo.map((fold, i) => ({
                    loopIndex: loopData[indexCombo[i]].loopIndex,
                    originalLength: loopData[indexCombo[i]].originalLength,
                    folds: fold.folds,
                  }));
                  lengthCombinations.set(sum, [
                    ...(lengthCombinations.get(sum) || []),
                    combination,
                  ]);
                });
              }
            }
          }
          // Calculate average spacing between available lengths
          function calculateAverageSpacing(sortedLengths) {
            if (sortedLengths.length < 2) return 0;

            let spacings = [];
            for (let i = 1; i < sortedLengths.length; i++) {
              spacings.push(sortedLengths[i] - sortedLengths[i - 1]);
            }

            const avgSpacing =
              spacings.reduce((sum, spacing) => sum + spacing, 0) /
              spacings.length;
            const minSpacing = Math.min(...spacings);
            const maxSpacing = Math.max(...spacings);

            return {
              average: avgSpacing,
              minimum: minSpacing,
              maximum: maxSpacing,
            };
          }

          // Format combination description
          function formatCombination(combination) {
            return combination
              .map((part) => {
                const foldText =
                  part.folds > 0 ? ` (folded ${part.folds}x)` : ' (unfolded)';
                return (
                  `Length ${part.loopIndex} (${part.originalLength}")` +
                  foldText
                );
              })
              .join(' + ');
          }

          // Calculate all combinations
          calculateCombinations(lengths);

          // Sort lengths for display
          const sortedLengths = Array.from(lengthCombinations.keys()).sort(
            (a, b) => a - b
          );
          const spacing = calculateAverageSpacing(sortedLengths);

          // Create display HTML
          const resultsDiv = document.getElementById('results');
          let html = '<div class="container mt-4">';

          // Summary section
          html += '<div class="card mb-4">';
          html += '<div class="card-header"><strong>Summary</strong></div>';
          html += '<div class="card-body">';
          // Length range and count
          html += `<h5 class="mb-3">Length Coverage</h5>`;
          html += `<p>Number of possible lengths: ${sortedLengths.length}</p>`;
          html += `<p>Range: ${sortedLengths[0].toFixed(1)} to ${sortedLengths[
            sortedLengths.length - 1
          ].toFixed(1)} inches (${(
            sortedLengths[sortedLengths.length - 1].toFixed(1) / 12
          ).toFixed(1)} feet)</p>`;

          // Spacing analysis
          html += `<h5 class="mb-3 mt-4">Length Spacing</h5>`;
          html += `<p>Average spacing between lengths: ${spacing.average.toFixed(
            1
          )} inches</p>`;
          html += `<p>Minimum spacing: ${spacing.minimum.toFixed(
            1
          )} inches</p>`;
          html += `<p>Maximum spacing: ${spacing.maximum.toFixed(
            1
          )} inches</p>`;

          // Rope requirements
          html += `<h5 class="mb-3 mt-4">Rope Requirements</h5>`;
          html +=
            '<div class="table-responsive"><table class="table table-sm">';
          html +=
            '<thead><tr><th>#</th><th>Length</th><th>Type</th><th>Rope Needed</th></tr></thead>';
          html += '<tbody>';

          ropeRequirements.forEach((req) => {
            html += `<tr>
            <td>Length ${req.loopNumber}</td>
            <td>${req.loopLength.toFixed(1)}"</td>
            <td>${req.type}</td>
            <td>${req.ropeNeeded.toFixed(1)}"</td>
        </tr>`;
          });

          html += `<tr class="table-active">
        <td colspan="3"><strong>Total Rope Needed</strong></td>
        <td><strong>${totalRopeNeeded.toFixed(1)} or ${(
            totalRopeNeeded.toFixed(1) / 12
          ).toFixed(1)} feet</strong></td>
    </tr>`;
          html += '</tbody></table></div>';

          html += '</div></div>';
          html += `<p>Number of possible lengths: ${sortedLengths.length}</p>`;
          html += `<p>Range: ${sortedLengths[0].toFixed(1)} to ${sortedLengths[
            sortedLengths.length - 1
          ].toFixed(1)} inches</p>`;
          html += '</div></div>';

          // Detailed results section
          html += '<div class="card">';
          html +=
            '<div class="card-header"><strong>All Possible Lengths and Combinations</strong></div>';
          html += '<div class="card-body">';

          sortedLengths.forEach((length) => {
            html += '<div class="mb-4">';
            html += `<h5 class="mb-2">${length.toFixed(1)}"</h5>`;
            html += '<ul class="list-unstyled ms-3">';
            lengthCombinations.get(length).forEach((combination) => {
              html += `<li class="mb-1">→ ${formatCombination(
                combination
              )}</li>`;
            });
            html += '</ul></div>';
          });

          html += '</div></div></div>';

          // Display results
          resultsDiv.innerHTML = html;
        }
      });
    </script>
  </body>
</html>
